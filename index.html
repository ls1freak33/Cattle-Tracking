<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Cattle Tracker</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
:root{
  --bg:#f2f2f2;--card:#fff;
  --primary:#2e7d32;--secondary:#0277bd;--danger:#c62828;
}
body{margin:0;padding:15px;font-family:Arial;background:var(--bg)}
h1{text-align:center}
button{width:100%;padding:14px;margin:6px 0;font-size:16px;border-radius:10px;border:none;color:#fff}
.primary{background:var(--primary)}
.secondary{background:var(--secondary)}
.danger{background:var(--danger)}
.small{width:80%;margin:8px auto}
input,select{width:100%;padding:12px;margin:6px 0;border-radius:8px;border:1px solid #ccc}
.card{background:var(--card);padding:15px;border-radius:12px;margin-top:12px}
.list{cursor:pointer}
.hidden{display:none}
.badge{background:#e8f5e9;padding:8px;border-radius:6px;margin:4px 0}
.badge.active{background:#c8e6c9}
</style>
</head>

<body>

<h1>üêÑ Cattle Tracker</h1>

<div id="screens">

<div id="home">
  <button class="primary" onclick="show('calves')">Calves</button>
  <button class="secondary" onclick="show('heifers')">Heifers</button>
  <button class="secondary" onclick="show('sold')">Sold / History</button>
</div>

<div id="calves" class="hidden">
  <button class="primary" onclick="show('addCalf')">‚ûï Add Calf</button>
  <div id="calfList"></div>
  <button class="secondary" onclick="show('home')">Back</button>
</div>

<div id="heifers" class="hidden">
  <h2>Heifers</h2>
  <div id="heiferList"></div>
  <button class="secondary" onclick="show('home')">Back</button>
</div>

<div id="addCalf" class="card hidden">
  <h2>Add Calf</h2>

  <select id="calfSex">
    <option>Female</option>
    <option>Male</option>
  </select>

  <input id="calfTag" placeholder="Tag (optional)">
  <input id="calfColor" placeholder="Tag Color">
  <input type="date" id="calfBirth">

  <button class="primary" onclick="saveCalf()">Save Calf</button>
  <button class="secondary" onclick="show('calves')">Cancel</button>
</div>

<div id="detail" class="card hidden"></div>

<div id="sold" class="hidden">
  <h2>Sold / History</h2>
  <div id="soldList"></div>
  <button class="secondary" onclick="show('home')">Back</button>
</div>

</div>

<script>
let animals = JSON.parse(localStorage.animals || "[]");
let editing = null;
let selectedVaccine = null;

const saveAll = () => localStorage.animals = JSON.stringify(animals);

const show = id => {
  document.querySelectorAll("#screens>div").forEach(d=>d.classList.add("hidden"));
  document.getElementById(id).classList.remove("hidden");
  refresh();
};

const refresh = () => {
  calfList.innerHTML = animals
    .filter(a=>a.role==="calf" && !a.sold)
    .map(a=>`<div class="card list" onclick="openAnimal(${a.id})">
      CALF | Tag ${a.tag||"‚Äî"}
    </div>`).join("");

  heiferList.innerHTML = animals
    .filter(a=>a.role==="heifer" && !a.sold)
    .map(a=>`<div class="card">
      HEIFER | Tag ${a.tag||"‚Äî"}
    </div>`).join("");

  soldList.innerHTML = animals
    .filter(a=>a.sold)
    .map(a=>`<div class="card">
      ${a.role.toUpperCase()} | Tag ${a.tag||"‚Äî"}
    </div>`).join("");
};

const saveCalf = () => {
  animals.push({
    id:Date.now(),
    role:"calf",
    sex:calfSex.value,
    tag:calfTag.value,
    color:calfColor.value,
    birth:calfBirth.value,
    cut: calfSex.value==="Male"?"No":null,
    vaccines:[],
    sold:false
  });
  saveAll(); show("calves");
};

const openAnimal = id => {
  editing = animals.find(a=>a.id===id);
  selectedVaccine = null;

  detail.innerHTML = `
    <h2>CALF</h2>

    Tag:<input id="eTag" value="${editing.tag||""}">
    Color:<input id="eColor" value="${editing.color||""}">
    Born:<input type="date" id="eBirth" value="${editing.birth||""}">

    <h3>Vaccines</h3>
    ${editing.vaccines.length
      ? editing.vaccines.map((v,i)=>`
        <div class="badge ${selectedVaccine===i?"active":""}"
             onclick="selectVaccine(${i})">
          ${v.date} ‚Äì ${v.note||""}
        </div>`).join("")
      : "<div class='badge'>None</div>"
    }

    <input type="date" id="vDate">
    <input id="vNote" placeholder="Vaccine note">

    <button class="secondary" onclick="addVaccine()">Add Vaccine</button>
    <button class="danger" onclick="deleteVaccine()">Delete Vaccine</button>

    <button class="primary small" onclick="saveEdits()">Save Changes</button>
    <button class="secondary" onclick="show('calves')">Back</button>
    <button class="secondary" onclick="promote()">Promote</button>
    <button class="danger" onclick="markSold()">Mark Sold</button>
  `;
  show("detail");
};

const selectVaccine = i => {
  selectedVaccine = i;
};

const addVaccine = () => {
  if(!vDate.value) return;
  editing.vaccines.push({date:vDate.value,note:vNote.value});
  saveAll();
  openAnimal(editing.id);
};

const deleteVaccine = () => {
  if(selectedVaccine===null) return;
  editing.vaccines.splice(selectedVaccine,1);
  saveAll();
  openAnimal(editing.id);
};

const saveEdits = () => {
  editing.tag = eTag.value;
  editing.color = eColor.value;
  editing.birth = eBirth.value;
  saveAll();
  show("calves");
};

const promote = () => {
  if(editing.sex==="Male") return alert("Male calves cannot be promoted.");
  editing.role = "heifer";
  saveAll();
  show("heifers");
};

const markSold = () => {
  editing.sold = true;
  saveAll();
  show("calves");
};

show("home");
</script>

</body>
</html>