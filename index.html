<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Cattle Tracker</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
:root{
  --bg:#f2f2f2;
  --card:#ffffff;
  --primary:#2e7d32;
  --secondary:#0277bd;
  --danger:#c62828;
  --gray:#777;
}
body{margin:0;padding:15px;font-family:Arial;background:var(--bg)}
h1{text-align:center;margin-bottom:10px}
h2,h3{margin-top:0}
button{
  width:100%;
  padding:14px;
  margin:6px 0;
  font-size:16px;
  border-radius:10px;
  border:none;
  color:#fff;
}
.primary{background:var(--primary)}
.secondary{background:var(--secondary)}
.danger{background:var(--danger)}
.small{width:80%;margin:10px auto}
input,select,textarea{
  width:100%;
  padding:12px;
  margin:6px 0;
  border-radius:8px;
  border:1px solid #ccc;
}
textarea{resize:vertical}
.card{
  background:var(--card);
  padding:15px;
  border-radius:12px;
  margin-top:12px;
}
.list{cursor:pointer}
.hidden{display:none}
.badge{
  background:#e8f5e9;
  padding:8px;
  border-radius:6px;
  margin:4px 0;
}
.badge.active{background:#c8e6c9}
.muted{color:var(--gray);font-size:14px}
</style>
</head>

<body>

<h1>üêÑ Cattle Tracker</h1>

<div id="screens">

<!-- HOME -->
<div id="home">
  <button class="primary" onclick="show('calves')">Calves</button>
  <button class="secondary" onclick="show('heifers')">Heifers</button>
  <button class="secondary" onclick="show('cows')">Cows</button>
  <button class="secondary" onclick="show('bulls')">Bull</button>
  <button class="secondary" onclick="show('history')">Sold / History</button>
</div>

<!-- LIST SCREENS -->
<div id="calves" class="hidden">
  <button class="primary" onclick="show('addCalf')">‚ûï Add Calf</button>
  <div id="calfList"></div>
  <button class="secondary" onclick="show('home')">Back</button>
</div>

<div id="heifers" class="hidden">
  <div id="heiferList"></div>
  <button class="secondary" onclick="show('home')">Back</button>
</div>

<div id="cows" class="hidden">
  <button class="primary" onclick="show('addCow')">‚ûï Add Cow</button>
  <div id="cowList"></div>
  <button class="secondary" onclick="show('home')">Back</button>
</div>

<div id="bulls" class="hidden">
  <button class="primary" onclick="show('addBull')">‚ûï Set Active Bull</button>
  <div id="bullList"></div>
  <button class="secondary" onclick="show('home')">Back</button>
</div>

<div id="history" class="hidden">
  <div id="historyList"></div>
  <button class="secondary" onclick="show('home')">Back</button>
</div>

<!-- ADD CALF -->
<div id="addCalf" class="card hidden">
  <h2>Add Calf</h2>
  <select id="calfSex">
    <option>Female</option>
    <option>Male</option>
  </select>
  <input id="calfTag" placeholder="Tag (optional)">
  <input id="calfColor" placeholder="Tag Color (optional)">
  <input type="date" id="calfBirth">
  <select id="calfDam"></select>
  <select id="calfSire"></select>
  <button class="primary" onclick="saveCalf()">Save Calf</button>
  <button class="secondary" onclick="show('calves')">Cancel</button>
</div>

<!-- ADD COW -->
<div id="addCow" class="card hidden">
  <h2>Add Cow</h2>
  <input id="cowTag" placeholder="Cow Tag">
  <button class="primary" onclick="saveCow()">Save Cow</button>
  <button class="secondary" onclick="show('cows')">Cancel</button>
</div>

<!-- ADD BULL -->
<div id="addBull" class="card hidden">
  <h2>Set Active Bull</h2>
  <input id="bullName" placeholder="Bull Name / Number">
  <button class="primary" onclick="saveBull()">Save Bull</button>
  <button class="secondary" onclick="show('bulls')">Cancel</button>
</div>

<!-- DETAIL -->
<div id="detail" class="card hidden"></div>

</div>

<script>
let animals = JSON.parse(localStorage.animals||"[]");
let bulls = JSON.parse(localStorage.bulls||"[]");
let editing=null;
let selectedVaccine=null;

const saveAll=()=>{
  localStorage.animals=JSON.stringify(animals);
  localStorage.bulls=JSON.stringify(bulls);
};

const show=id=>{
  document.querySelectorAll("#screens>div").forEach(d=>d.classList.add("hidden"));
  document.getElementById(id).classList.remove("hidden");
  refresh();
};

const refresh=()=>{
  calfList.innerHTML=animals.filter(a=>a.role==="calf"&&!a.sold)
    .map(a=>card(a)).join("");

  heiferList.innerHTML=animals.filter(a=>a.role==="heifer"&&!a.sold)
    .map(a=>card(a)).join("");

  cowList.innerHTML=animals.filter(a=>a.role==="cow"&&!a.sold)
    .map(a=>card(a)).join("");

  historyList.innerHTML=animals.filter(a=>a.sold)
    .map(a=>card(a,true)).join("");

  bullList.innerHTML=bulls.filter(b=>!b.sold)
    .map(b=>`<div class="card list" onclick="openBull(${b.id})">üêÇ ${b.name}</div>`).join("");

  calfDam.innerHTML=`<option value="">Unknown Cow</option>`+
    animals.filter(a=>a.role==="cow"&&!a.sold)
      .map(c=>`<option value="${c.id}">${c.tag||"Cow"}</option>`).join("");

  calfSire.innerHTML=`<option value="">Unknown Sire</option>`+
    bulls.filter(b=>!b.sold).map(b=>`<option>${b.name}</option>`).join("");
};

const card=a=>`
<div class="card list" onclick="openAnimal(${a.id})">
<b>${a.role.toUpperCase()}</b> | ${a.tag||"No Tag"}
</div>`;

const saveCalf=()=>{
  animals.push({
    id:Date.now(),
    role:"calf",
    sex:calfSex.value,
    tag:calfTag.value,
    color:calfColor.value,
    birth:calfBirth.value,
    dam:calfDam.value||null,
    sire:calfSire.value||null,
    cut: calfSex.value==="Male"?"No":null,
    vaccines:[],
    sold:false
  });
  saveAll();show("calves");
};

const openAnimal=id=>{
  editing=JSON.parse(JSON.stringify(animals.find(a=>a.id===id)));
  selectedVaccine=null;

  detail.innerHTML=`
  <h2>${editing.role.toUpperCase()}</h2>

  Tag:<input id="eTag" value="${editing.tag||""}">
  Color:<input id="eColor" value="${editing.color||""}">
  Born:<input type="date" id="eBirth" value="${editing.birth||""}">

  <h3>Vaccines</h3>
  ${editing.vaccines.length
    ? editing.vaccines.map((v,i)=>`
      <div class="badge ${selectedVaccine===i?"active":""}"
           onclick="selectVaccine(${i})">
        ${v.date} ‚Äì ${v.note||""}
      </div>`).join("")
    : "<div class='badge'>None</div>"
  }

  <input type="date" id="vDate">
  <input id="vNote" placeholder="Vaccine note">
  <button class="secondary" onclick="addOrUpdateVaccine()">Add / Update Vaccine</button>
  <button class="danger" onclick="deleteVaccine()">Delete Vaccine</button>

  ${editing.sex==="Male"?`
  Cut:
  <select id="eCut">
    <option ${editing.cut==="No"?"selected":""}>No</option>
    <option ${editing.cut==="Yes"?"selected":""}>Yes</option>
  </select>`:""}

  <button class="primary small" onclick="saveEdits()">Save Changes</button>
  <button class="secondary small" onclick="promote()">Promote</button>
  <button class="danger small" onclick="markSold()">Mark Sold</button>
  <button class="secondary" onclick="show('${editing.role}s')">Back</button>
  `;
  show("detail");
};

const selectVaccine=i=>{
  selectedVaccine=i;
  vDate.value=editing.vaccines[i].date;
  vNote.value=editing.vaccines[i].note||"";
};

const addOrUpdateVaccine=()=>{
  if(!vDate.value)return;
  if(selectedVaccine===null)
    editing.vaccines.push({date:vDate.value,note:vNote.value});
  else
    editing.vaccines[selectedVaccine]={date:vDate.value,note:vNote.value};
  selectedVaccine=null;
  openAnimal(editing.id);
};

const deleteVaccine=()=>{
  if(selectedVaccine===null)return;
  editing.vaccines.splice(selectedVaccine,1);
  selectedVaccine=null;
  openAnimal(editing.id);
};

const saveEdits=()=>{
  let i=animals.findIndex(a=>a.id===editing.id);
  animals[i]={...animals[i],
    tag:eTag.value,
    color:eColor.value,
    birth:eBirth.value,
    vaccines:editing.vaccines,
    cut: editing.sex==="Male"?eCut?.value:null
  };
  saveAll();show(editing.role+"s");
};

const promote=()=>{
  if(editing.role==="calf")editing.role="heifer";
  else if(editing.role==="heifer")editing.role="cow";
  saveEdits();
};

const markSold=()=>{
  if(!confirm("Mark as sold?"))return;
  let i=animals.findIndex(a=>a.id===editing.id);
  animals[i].sold=true;
  saveAll();show("history");
};

const saveCow=()=>{
  animals.push({id:Date.now(),role:"cow",tag:cowTag.value,vaccines:[],sold:false});
  saveAll();show("cows");
};

const saveBull=()=>{
  bulls.forEach(b=>b.sold=true);
  bulls.push({id:Date.now(),name:bullName.value,vaccines:[],sold:false});
  saveAll();show("bulls");
};

show("home");
</script>

</body>
</html>